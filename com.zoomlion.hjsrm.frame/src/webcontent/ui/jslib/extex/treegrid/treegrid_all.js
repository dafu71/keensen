Ext.namespace("Ext.ux.tree");Ext.list.Column=Ext.extend(Object,{isColumn:true,align:"left",header:"",width:null,cls:"",constructor:function(B){if(!B.tpl){B.tpl=new Ext.XTemplate("{"+B.dataIndex+"}")}else{if(Ext.isString(B.tpl)){B.tpl=new Ext.XTemplate(B.tpl)}}Ext.apply(this,B)}});Ext.reg("lvcolumn",Ext.list.Column);Ext.list.NumberColumn=Ext.extend(Ext.list.Column,{format:"0,000.00",constructor:function(B){B.tpl=B.tpl||new Ext.XTemplate("{"+B.dataIndex+':number("'+(B.format||this.format)+'")}');Ext.list.NumberColumn.superclass.constructor.call(this,B)}});Ext.reg("lvnumbercolumn",Ext.list.NumberColumn);Ext.list.DateColumn=Ext.extend(Ext.list.Column,{format:"m/d/Y",constructor:function(B){B.tpl=B.tpl||new Ext.XTemplate("{"+B.dataIndex+':date("'+(B.format||this.format)+'")}');Ext.list.DateColumn.superclass.constructor.call(this,B)}});Ext.reg("lvdatecolumn",Ext.list.DateColumn);Ext.list.BooleanColumn=Ext.extend(Ext.list.Column,{trueText:"true",falseText:"false",undefinedText:"&#160;",constructor:function(H){H.tpl=H.tpl||new Ext.XTemplate("{"+H.dataIndex+":this.format}");var F=this.trueText,E=this.falseText,G=this.undefinedText;H.tpl.format=function(A){if(A===undefined){return G}if(!A||A==="false"){return E}return F};Ext.list.DateColumn.superclass.constructor.call(this,H)}});Ext.reg("lvbooleancolumn",Ext.list.BooleanColumn);Ext.list.ColumnResizer=Ext.extend(Ext.util.Observable,{minPct:0.05,constructor:function(B){Ext.apply(this,B);Ext.list.ColumnResizer.superclass.constructor.call(this)},init:function(B){this.view=B;B.on("render",this.initEvents,this)},initEvents:function(B){B.mon(B.innerHd,"mousemove",this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(B.innerHd);B.on("beforedestroy",this.tracker.destroy,this.tracker)},handleHdMove:function(L,K){var P=5,N=L.getPageX(),M=L.getTarget("em",3,true);if(M){var J=M.getRegion(),O=M.dom.style,I=M.dom.parentNode;if(N-J.left<=P&&I!=I.parentNode.firstChild){this.activeHd=Ext.get(I.previousSibling.firstChild);O.cursor=Ext.isWebKit?"e-resize":"col-resize"}else{if(J.right-N<=P&&I!=I.parentNode.lastChild.previousSibling){this.activeHd=M;O.cursor=Ext.isWebKit?"w-resize":"col-resize"}else{delete this.activeHd;O.cursor=""}}}},onBeforeStart:function(B){this.dragHd=this.activeHd;return !!this.dragHd},onStart:function(F){this.view.disableHeaders=true;this.proxy=this.view.el.createChild({cls:"x-list-resizer"});this.proxy.setHeight(this.view.el.getHeight());var D=this.tracker.getXY()[0],E=this.view.innerHd.getWidth();this.hdX=this.dragHd.getX();this.hdIndex=this.view.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(D-this.hdX);this.minWidth=E*this.minPct;this.maxWidth=E-(this.minWidth*(this.view.columns.length-1-this.hdIndex))},onDrag:function(D){var C=this.tracker.getXY()[0];this.proxy.setWidth((C-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(Y){var d=this.proxy.getWidth();this.proxy.remove();var X=this.hdIndex,c=this.view,W=c.columns,V=W.length,b=this.view.innerHd.getWidth(),T=this.minPct*100,R=Math.ceil((d*c.maxWidth)/b),Z=(W[X].width*100)-R,U=Math.floor(Z/(V-1-X)),P=Z-(U*(V-1-X));for(var Q=X+1;Q<V;Q++){var S=(W[Q].width*100)+U,a=Math.max(T,S);if(S!=a){P+=S-a}W[Q].width=a/100}W[X].width=R/100;W[X+1].width+=(P/100);delete this.dragHd;c.setHdWidths();c.refresh();setTimeout(function(){c.disableHeaders=false},100)}});Ext.ListView.ColumnResizer=Ext.list.ColumnResizer;Ext.list.ListView=Ext.extend(Ext.DataView,{itemSelector:"dl",selectedClass:"x-list-selected",overClass:"x-list-over",scrollOffset:undefined,columnResize:true,columnSort:true,maxWidth:Ext.isIE?99:100,initComponent:function(){if(this.columnResize){this.colResizer=new Ext.list.ColumnResizer(this.colResizer);this.colResizer.init(this)}if(this.columnSort){this.colSorter=new Ext.list.Sorter(this.columnSort);this.colSorter.init(this)}if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-list-header"><div class="x-list-header-inner">','<tpl for="columns">','<div style="width:{[values.width*100]}%;text-align:{align};"><em unselectable="on" id="',this.id,'-xlhd-{#}">',"{header}","</em></div>","</tpl>",'<div class="x-clear"></div>',"</div></div>",'<div class="x-list-body"><div class="x-list-body-inner">',"</div></div>")}if(!this.tpl){this.tpl=new Ext.XTemplate('<tpl for="rows">',"<dl>",'<tpl for="parent.columns">','<dt style="width:{[values.width*100]}%;text-align:{align};">','<em unselectable="on"<tpl if="cls"> class="{cls}</tpl>">',"{[values.tpl.apply(parent)]}","</em></dt>","</tpl>",'<div class="x-clear"></div>',"</dl>","</tpl>")}var M=this.columns,R=0,Q=0,O=M.length,S=[];for(var K=0;K<O;K++){var T=M[K];if(!T.isColumn){T.xtype=T.xtype?(/^lv/.test(T.xtype)?T.xtype:"lv"+T.xtype):"lvcolumn";T=Ext.create(T)}if(T.width){R+=T.width*100;Q++}S.push(T)}M=this.columns=S;if(Q<O){var N=O-Q;if(R<this.maxWidth){var L=((this.maxWidth-R)/N)/100;for(var P=0;P<O;P++){var T=M[P];if(!T.width){T.width=L}}}}Ext.list.ListView.superclass.initComponent.call(this)},onRender:function(){this.autoEl={cls:"x-list-wrap"};Ext.list.ListView.superclass.onRender.apply(this,arguments);this.internalTpl.overwrite(this.el,{columns:this.columns});this.innerBody=Ext.get(this.el.dom.childNodes[1].firstChild);this.innerHd=Ext.get(this.el.dom.firstChild.firstChild);if(this.hideHeaders){this.el.dom.firstChild.style.display="none"}},getTemplateTarget:function(){return this.innerBody},collectData:function(){var B=Ext.list.ListView.superclass.collectData.apply(this,arguments);return{columns:this.columns,rows:B}},verifyInternalSize:function(){if(this.lastSize){this.onResize(this.lastSize.width,this.lastSize.height)}},onResize:function(I,L){var H=this.innerBody.dom;var G=this.innerHd.dom;if(!H){return}var J=H.parentNode;if(Ext.isNumber(I)){var K=I-Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((J.offsetWidth-J.clientWidth)>10)){H.style.width=K+"px";G.style.width=K+"px"}else{H.style.width=I+"px";G.style.width=I+"px";setTimeout(function(){if((J.offsetWidth-J.clientWidth)>10){H.style.width=K+"px";G.style.width=K+"px"}},10)}}if(Ext.isNumber(L)){J.style.height=(L-G.parentNode.offsetHeight)+"px"}},updateIndexes:function(){Ext.list.ListView.superclass.updateIndexes.apply(this,arguments);this.verifyInternalSize()},findHeaderIndex:function(G){G=G.dom||G;var F=G.parentNode,H=F.parentNode.childNodes;for(var J=0,I;I=H[J];J++){if(I==F){return J}}return -1},setHdWidths:function(){var G=this.innerHd.dom.getElementsByTagName("div");for(var H=0,F=this.columns,E=F.length;H<E;H++){G[H].style.width=(F[H].width*100)+"%"}}});Ext.reg("listview",Ext.list.ListView);Ext.ListView=Ext.list.ListView;Ext.list.Sorter=Ext.extend(Ext.util.Observable,{sortClasses:["sort-asc","sort-desc"],constructor:function(B){Ext.apply(this,B);Ext.list.Sorter.superclass.constructor.call(this)},init:function(B){this.view=B;B.on("render",this.initEvents,this)},initEvents:function(B){B.mon(B.innerHd,"click",this.onHdClick,this);B.innerHd.setStyle("cursor","pointer");B.mon(B.store,"datachanged",this.updateSortState,this);this.updateSortState.defer(10,this,[B.store])},updateSortState:function(N){var I=N.getSortState();if(!I){return}this.sortState=I;var J=this.view.columns,M=-1;for(var L=0,K=J.length;L<K;L++){if(J[L].dataIndex==I.field){M=L;break}}if(M!=-1){var H=I.direction;this.updateSortIcon(M,H)}},updateSortIcon:function(F,H){var E=this.sortClasses;var G=this.view.innerHd.select("em").removeClass(E);G.item(F).addClass(E[H=="DESC"?1:0])},onHdClick:function(F){var E=F.getTarget("em",3);if(E&&!this.view.disableHeaders){var D=this.view.findHeaderIndex(E);this.view.store.sort(this.view.columns[D].dataIndex)}}});Ext.ListView.Sorter=Ext.list.Sorter;(function(){Ext.override(Ext.list.Column,{init:function(){var C=Ext.data.Types,D=this.sortType;if(this.type){if(Ext.isString(this.type)){this.type=Ext.data.Types[this.type.toUpperCase()]||C.AUTO}}else{this.type=C.AUTO}if(Ext.isString(D)){this.sortType=Ext.data.SortTypes[D]}else{if(Ext.isEmpty(D)){this.sortType=this.type.sortType}}}});Ext.tree.Column=Ext.extend(Ext.list.Column,{});Ext.tree.NumberColumn=Ext.extend(Ext.list.NumberColumn,{});Ext.tree.DateColumn=Ext.extend(Ext.list.DateColumn,{});Ext.tree.BooleanColumn=Ext.extend(Ext.list.BooleanColumn,{});Ext.tree.DictColumn=Ext.extend(Ext.list.Column,{constructor:function(B){_data=[];B.tpl=B.tpl||new Ext.XTemplate("{"+B.dataIndex+":this.format}");B.tpl.format=function(D){_data=B.dictData;for(var A=0;A<_data.length;A++){if(D===_data[A].DICTID){return _data[A].DICTNAME}if(D===""||D===null||D===undefined){return""}}};Ext.tree.DictColumn.superclass.constructor.call(this,B)}});Ext.reg("tgcolumn",Ext.tree.Column);Ext.reg("tgnumbercolumn",Ext.tree.NumberColumn);Ext.reg("tgdatecolumn",Ext.tree.DateColumn);Ext.reg("tgbooleancolumn",Ext.tree.BooleanColumn);Ext.reg("tgdictcolumn",Ext.tree.DictColumn)})();Ext.tree.ColumnResizer=Ext.extend(Ext.util.Observable,{minWidth:14,constructor:function(B){Ext.apply(this,B);Ext.tree.ColumnResizer.superclass.constructor.call(this)},init:function(B){this.tree=B;B.on("render",this.initEvents,this)},initEvents:function(B){B.mon(B.innerHd,"mousemove",this.handleHdMove,this);this.tracker=new Ext.dd.DragTracker({onBeforeStart:this.onBeforeStart.createDelegate(this),onStart:this.onStart.createDelegate(this),onDrag:this.onDrag.createDelegate(this),onEnd:this.onEnd.createDelegate(this),tolerance:3,autoStart:300});this.tracker.initEl(B.innerHd);B.on("beforedestroy",this.tracker.destroy,this.tracker)},handleHdMove:function(O,N){var P=5,K=O.getPageX(),Q=O.getTarget(".x-treegrid-hd",3,true);if(Q){var M=Q.getRegion(),R=Q.dom.style,L=Q.dom.parentNode;if(K-M.left<=P&&Q.dom!==L.firstChild){var S=Q.dom.previousSibling;while(S&&Ext.fly(S).hasClass("x-treegrid-hd-hidden")){S=S.previousSibling}if(S){this.activeHd=Ext.get(S);R.cursor=Ext.isWebKit?"e-resize":"col-resize"}}else{if(M.right-K<=P){var T=Q.dom;while(T&&Ext.fly(T).hasClass("x-treegrid-hd-hidden")){T=T.previousSibling}if(T){this.activeHd=Ext.get(T);R.cursor=Ext.isWebKit?"w-resize":"col-resize"}}else{delete this.activeHd;R.cursor=""}}}},onBeforeStart:function(B){this.dragHd=this.activeHd;return !!this.dragHd},onStart:function(D){this.dragHeadersDisabled=this.tree.headersDisabled;this.tree.headersDisabled=true;this.proxy=this.tree.body.createChild({cls:"x-treegrid-resizer"});this.proxy.setHeight(this.tree.body.getHeight());var C=this.tracker.getXY()[0];this.hdX=this.dragHd.getX();this.hdIndex=this.tree.findHeaderIndex(this.dragHd);this.proxy.setX(this.hdX);this.proxy.setWidth(C-this.hdX);this.maxWidth=this.tree.outerCt.getWidth()-this.tree.innerBody.translatePoints(this.hdX).left},onDrag:function(D){var C=this.tracker.getXY()[0];this.proxy.setWidth((C-this.hdX).constrain(this.minWidth,this.maxWidth))},onEnd:function(G){var H=this.proxy.getWidth(),F=this.tree,E=this.dragHeadersDisabled;this.proxy.remove();delete this.dragHd;F.columns[this.hdIndex].width=H;F.updateColumnWidths();setTimeout(function(){F.headersDisabled=E},100)}});Ext.ux.tree.TreeGridSorter=Ext.extend(Ext.tree.TreeSorter,{sortClasses:["sort-asc","sort-desc"],sortAscText:"Sort Ascending",sortDescText:"Sort Descending",constructor:function(F,D){if(!Ext.isObject(D)){D={property:F.columns[0].dataIndex||"text",folderSort:true}}Ext.ux.tree.TreeGridSorter.superclass.constructor.apply(this,arguments);this.tree=F;F.on("headerclick",this.onHeaderClick,this);F.ddAppendOnly=true;var E=this;this.defaultSortFn=function(Q,T){var X=E.dir&&E.dir.toLowerCase()=="desc",B=E.property||"text",W=E.sortType,S=E.caseSensitive===true,U=E.leafAttr||"leaf",V=Q.attributes,P=T.attributes;if(E.folderSort){if(V[U]&&!P[U]){return 1}if(!V[U]&&P[U]){return -1}}var C=V[B],R=P[B],A=W?W(C):(S?C:C.toUpperCase());v2=W?W(R):(S?R:R.toUpperCase());if(A<v2){return X?+1:-1}else{if(A>v2){return X?-1:+1}else{return 0}}};F.on("afterrender",this.onAfterTreeRender,this,{single:true});F.on("headermenuclick",this.onHeaderMenuClick,this)},onAfterTreeRender:function(){if(this.tree.hmenu){this.tree.hmenu.insert(0,{itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"})}this.updateSortIcon(0,"asc")},onHeaderMenuClick:function(D,E,F){if(E==="asc"||E==="desc"){this.onHeaderClick(D,null,F);return false}},onHeaderClick:function(E,H,F){if(E&&!this.tree.headersDisabled){var G=this;G.property=E.dataIndex;G.dir=E.dir=(E.dir==="desc"?"asc":"desc");G.sortType=E.sortType;G.caseSensitive===Ext.isBoolean(E.caseSensitive)?E.caseSensitive:this.caseSensitive;G.sortFn=E.sortFn||this.defaultSortFn;this.tree.root.cascade(function(A){if(!A.isLeaf()){G.updateSort(G.tree,A)}});this.updateSortIcon(F,E.dir)}},updateSortIcon:function(F,H){var E=this.sortClasses,G=this.tree.innerHd.select("td").removeClass(E);G.item(F).addClass(E[H=="desc"?1:0])}});Ext.ux.tree.TreeGridNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,renderElements:function(R,V,T,L){var P=R.getOwnerTree(),U=P.columns,N=U[0],M,S,Q;this.indentMarkup=R.parentNode?R.parentNode.ui.getChildIndent():"";S=['<tbody class="x-tree-node">','<tr ext:tree-node-id="',R.id,'" class="x-tree-node-el x-tree-node-leaf ',V.cls,'">','<td class="x-treegrid-col">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',V.icon||this.emptyIcon,'" class="x-tree-node-icon',(V.icon?" x-tree-node-inline-icon":""),(V.iconCls?" "+V.iconCls:""),'" unselectable="on" />','<a hidefocus="on" class="x-tree-node-anchor" href="',V.href?V.href:"#",'" tabIndex="1" ',V.hrefTarget?' target="'+V.hrefTarget+'"':"",">",'<span unselectable="on">',(N.tpl?N.tpl.apply(V):V[N.dataIndex]||N.text),"</span></a>","</td>"];for(M=1,Q=U.length;M<Q;M++){N=U[M];S.push('<td class="x-treegrid-col ',(N.cls?N.cls:""),'">','<div unselectable="on" class="x-treegrid-text"',(N.align?' style="text-align: '+N.align+';"':""),">",(N.tpl?N.tpl.apply(V):V[N.dataIndex]),"</div>","</td>")}S.push('</tr><tr class="x-tree-node-ct"><td colspan="',U.length,'">','<table class="x-treegrid-node-ct-table" cellpadding="0" cellspacing="0" style="table-layout: fixed; display: none; width: ',P.innerCt.getWidth(),'px;"><colgroup>');for(M=0,Q=U.length;M<Q;M++){S.push('<col style="width: ',(U[M].hidden?0:U[M].width),'px;" />')}S.push("</colgroup></table></td></tr></tbody>");if(L!==true&&R.nextSibling&&R.nextSibling.ui.getEl()){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",R.nextSibling.ui.getEl(),S.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",T,S.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1].firstChild.firstChild;var O=this.elNode.firstChild.childNodes;this.indentNode=O[0];this.ecNode=O[1];this.iconNode=O[2];this.anchor=O[3];this.textNode=O[3].firstChild},animExpand:function(B){this.ctNode.style.display="";Ext.ux.tree.TreeGridNodeUI.superclass.animExpand.call(this,B)}});Ext.ux.tree.TreeGridRootNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{isTreeGridNodeUI:true,render:function(){if(!this.rendered){this.wrap=this.ctNode=this.node.ownerTree.innerCt.dom;this.node.expanded=true}if(Ext.isWebKit){var B=this.ctNode;B.style.tableLayout=null;(function(){B.style.tableLayout="fixed"}).defer(1)}},destroy:function(){if(this.elNode){Ext.dd.Registry.unregister(this.elNode.id)}delete this.node},collapse:Ext.emptyFn,expand:Ext.emptyFn});Ext.ux.tree.TreeGridLoader=Ext.extend(Ext.tree.TreeLoader,{constructor:function(B){Ext.apply(this,B);this.addEvents("beforeload","load","loadexception");Ext.ux.tree.TreeGridLoader.superclass.constructor.call(this)},createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false&&!attr.loader){attr.loader=this}if(Ext.isString(attr.uiProvider)){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{attr.loaded=true;var s=attr.leaf=="y"?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr);s.attributes.leaf=true;return s}},processResponse:function(R,Q,W,a){var P=this.root;var V=this.parentField;var S=this.childField;var Y=this.textField;var T=this.checked;var X=R.responseText;var b=Ext.decode(X);try{var O=b[P];if(O.length>0){for(var U in O[0]){if(U.trim().toUpperCase()==V.trim().toUpperCase()){V=U}if(U.trim().toUpperCase()==S.trim().toUpperCase()){S=U}}}this.appendChild(Q,O,{parentField:V,childField:S,textField:Y,checked:T});this.runCallback(W,a||Q,[Q])}catch(Z){this.handleFailure(R)}},appendChild:function(S,R,O){if(!S||!R||!O||!O.parentField||!O.childField){this.handleFailure(response)}var M=O.parentField;var Q=O.childField;var L=O.textField;var T=O.checked;S.beginUpdate();for(var K=0;K<R.length;K++){var N=R[K];N["id"]="r"+N[Q];N["text"]=N[L];N["leaf"]=N["isleaf"].toUpperCase()=="Y"?true:false;if(N[M]!=S.attributes[Q]){continue}if(N["added"]){continue}if(N["checked"]=="1"||N["checked"]=="true"){N["checked"]=true}var P=this.createNode(N);N["added"]=true;if(P){S.appendChild(P)}this.appendChild(P,R,O)}S.endUpdate()}});Ext.ux.tree.TreeGrid=Ext.extend(Ext.tree.TreePanel,{rootVisible:false,useArrows:true,lines:false,borderWidth:Ext.isBorderBox?0:2,cls:"x-treegrid",columnResize:true,enableSort:true,reserveScrollOffset:true,enableHdMenu:true,columnsText:"Columns",initComponent:function(){if(!this.root){this.root=new Ext.tree.AsyncTreeNode({text:"Root"})}var D=this.loader;if(!D){D=new Ext.ux.tree.TreeGridLoader({dataUrl:this.dataUrl,requestMethod:this.requestMethod,store:this.store})}else{if(Ext.isObject(D)&&!D.load){D=new Ext.ux.tree.TreeGridLoader(D)}}this.loader=D;Ext.ux.tree.TreeGrid.superclass.initComponent.call(this);this.initColumns();if(this.enableSort){this.treeGridSorter=new Ext.ux.tree.TreeGridSorter(this,this.enableSort)}if(this.columnResize){this.colResizer=new Ext.tree.ColumnResizer(this.columnResize);this.colResizer.init(this)}var C=this.columns;if(!this.internalTpl){this.internalTpl=new Ext.XTemplate('<div class="x-grid3-header">','<div class="x-treegrid-header-inner">','<div class="x-grid3-header-offset">','<table style="table-layout: fixed;" cellspacing="0" cellpadding="0" border="0"><colgroup><tpl for="columns"><col /></tpl></colgroup>','<thead><tr class="x-grid3-hd-row">','<tpl for="columns">','<td class="x-grid3-hd x-grid3-cell x-treegrid-hd" style="text-align: {align};" id="',this.id,'-xlhd-{#}">','<div class="x-grid3-hd-inner x-treegrid-hd-inner" unselectable="on">',this.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"",'{header}<img class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td></tpl>","</tr></thead>","</table>","</div></div>","</div>",'<div class="x-treegrid-root-node">','<table class="x-treegrid-root-table" cellpadding="0" cellspacing="0" style="table-layout: fixed;"></table>',"</div>")}if(!this.colgroupTpl){this.colgroupTpl=new Ext.XTemplate('<colgroup><tpl for="columns"><col style="width: {width}px"/></tpl></colgroup>')}},initColumns:function(){var H=this.columns,I=H.length,G=[],J,F;for(J=0;J<I;J++){F=H[J];if(!F.isColumn){F.xtype=F.xtype?(/^tg/.test(F.xtype)?F.xtype:"tg"+F.xtype):"tgcolumn";F=Ext.create(F)}F.init(this);G.push(F);if(this.enableSort!==false&&F.sortable!==false){F.sortable=true;this.enableSort=true}}this.columns=G},onRender:function(){Ext.tree.TreePanel.superclass.onRender.apply(this,arguments);this.el.addClass("x-treegrid");this.outerCt=this.body.createChild({cls:"x-tree-root-ct x-treegrid-ct "+(this.useArrows?"x-tree-arrows":this.lines?"x-tree-lines":"x-tree-no-lines")});this.internalTpl.overwrite(this.outerCt,{columns:this.columns});this.mainHd=Ext.get(this.outerCt.dom.firstChild);this.innerHd=Ext.get(this.mainHd.dom.firstChild);this.innerBody=Ext.get(this.outerCt.dom.lastChild);this.innerCt=Ext.get(this.innerBody.dom.firstChild);this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns});if(this.hideHeaders){this.el.child(".x-grid3-header").setDisplayed("none")}else{if(this.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:this.id+"-hctx"});if(this.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:this.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add({itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}}},setRootNode:function(B){B.attributes.uiProvider=Ext.ux.tree.TreeGridRootNodeUI;B=Ext.ux.tree.TreeGrid.superclass.setRootNode.call(this,B);if(this.innerCt){this.colgroupTpl.insertFirst(this.innerCt,{columns:this.columns})}return B},clearInnerCt:function(){if(Ext.isIE){var B=this.innerCt.dom;while(B.firstChild){B.removeChild(B.firstChild)}}else{Ext.ux.tree.TreeGrid.superclass.clearInnerCt.call(this)}},initEvents:function(){Ext.ux.tree.TreeGrid.superclass.initEvents.apply(this,arguments);this.mon(this.innerBody,"scroll",this.syncScroll,this);this.mon(this.innerHd,"click",this.handleHdDown,this);this.mon(this.mainHd,{scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut})},onResize:function(I,L){Ext.ux.tree.TreeGrid.superclass.onResize.apply(this,arguments);var K=this.innerBody.dom;var G=this.innerHd.dom;if(!K){return}if(Ext.isNumber(L)){K.style.height=this.body.getHeight(true)-G.offsetHeight+"px"}if(Ext.isNumber(I)){var J=Ext.num(this.scrollOffset,Ext.getScrollBarWidth());if(this.reserveScrollOffset||((K.offsetWidth-K.clientWidth)>10)){this.setScrollOffset(J)}else{var H=this;setTimeout(function(){H.setScrollOffset(K.offsetWidth-K.clientWidth>10?J:0)},10)}}},updateColumnWidths:function(){var Q=this.columns,J=Q.length,R=this.outerCt.query("colgroup"),N=R.length,P,K,O,L;for(O=0;O<J;O++){P=Q[O];for(L=0;L<N;L++){K=R[L];K.childNodes[O].style.width=(P.hidden?0:P.width)+"px"}}for(O=0,R=this.innerHd.query("td"),len=R.length;O<len;O++){P=Ext.fly(R[O]);if(Q[O]&&Q[O].hidden){P.addClass("x-treegrid-hd-hidden")}else{P.removeClass("x-treegrid-hd-hidden")}}var M=this.getTotalColumnWidth();Ext.fly(this.innerHd.dom.firstChild).setWidth(M+(this.scrollOffset||0));this.outerCt.select("table").setWidth(M);this.syncHeaderScroll()},getVisibleColumns:function(){var E=[],F=this.columns,G=F.length,H;for(H=0;H<G;H++){if(!F[H].hidden){E.push(F[H])}}return E},getTotalColumnWidth:function(){var F=0;for(var H=0,G=this.getVisibleColumns(),E=G.length;H<E;H++){F+=G[H].width}return F},setScrollOffset:function(B){this.scrollOffset=B;this.updateColumnWidths()},handleHdDown:function(P,O){var M=P.getTarget(".x-treegrid-hd");if(M&&Ext.fly(O).hasClass("x-grid3-hd-btn")){var L=this.hmenu.items,J=this.columns,K=this.findHeaderIndex(M),N=J[K],I=N.sortable;P.stopEvent();Ext.fly(M).addClass("x-grid3-hd-menu-open");this.hdCtxIndex=K;this.fireEvent("headerbuttonclick",L,N,M,K);this.hmenu.on("hide",function(){Ext.fly(M).removeClass("x-grid3-hd-menu-open")},this,{single:true});this.hmenu.show(O,"tl-bl?")}else{if(M){var K=this.findHeaderIndex(M);this.fireEvent("headerclick",this.columns[K],M,K)}}},handleHdOver:function(F,G){var E=F.getTarget(".x-treegrid-hd");if(E&&!this.headersDisabled){index=this.findHeaderIndex(E);this.activeHdRef=G;this.activeHdIndex=index;var H=Ext.get(E);this.activeHdRegion=H.getRegion();H.addClass("x-grid3-hd-over");this.activeHdBtn=H.child(".x-grid3-hd-btn");if(this.activeHdBtn){this.activeHdBtn.dom.style.height=(E.firstChild.offsetHeight-1)+"px"}}},handleHdOut:function(F,D){var E=F.getTarget(".x-treegrid-hd");if(E&&(!Ext.isIE||!F.within(E,true))){this.activeHdRef=null;Ext.fly(E).removeClass("x-grid3-hd-over");E.style.cursor=""}},findHeaderIndex:function(E){E=E.dom||E;var F=E.parentNode.childNodes;for(var H=0,G;G=F[H];H++){if(G==E){return H}}return -1},beforeColMenuShow:function(){var G=this.columns,H=G.length,F,E;this.colMenu.removeAll();for(F=1;F<H;F++){E=G[F];if(E.hideable!==false){this.colMenu.add(new Ext.menu.CheckItem({itemId:"col-"+F,text:E.header,checked:!E.hidden,hideOnClick:false,disabled:E.hideable===false}))}}},handleHdMenuClick:function(F){var D=this.hdCtxIndex,E=F.getItemId();if(this.fireEvent("headermenuclick",this.columns[D],E,D)!==false){D=E.substr(4);if(D>0&&this.columns[D]){this.setColumnVisible(D,!F.checked)}}return true},setColumnVisible:function(C,D){this.columns[C].hidden=!D;this.updateColumnWidths()},scrollToTop:function(){this.innerBody.dom.scrollTop=0;this.innerBody.dom.scrollLeft=0},syncScroll:function(){this.syncHeaderScroll();var B=this.innerBody.dom;this.fireEvent("bodyscroll",B.scrollLeft,B.scrollTop)},syncHeaderScroll:function(){var B=this.innerBody.dom;this.innerHd.dom.scrollLeft=B.scrollLeft;this.innerHd.dom.scrollLeft=B.scrollLeft},registerNode:function(B){Ext.ux.tree.TreeGrid.superclass.registerNode.call(this,B);if(!B.uiProvider&&!B.isRoot&&!B.ui.isTreeGridNodeUI){B.ui=new Ext.ux.tree.TreeGridNodeUI(B)}}});Ext.reg("treegrid",Ext.ux.tree.TreeGrid);